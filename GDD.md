# 🎮 游戏设计文档（Game Design Document）

**项目名称：** 《未命名生存经营游戏》（暂定）  
**版本：** v1.2  
**最后更新：** 2025-12-14  
**项目类型：** 3D 生存经营游戏  
**开发引擎：** Babylon.js + Vue3  

---

## 📜 版本历史

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|---------|------|
| v1.0 | 2025-12-10 | 初始版本，确立核心玩法和系统设计 | [你的名字] |
| v1.1 | 2025-12-11 | 更新采集系统（HP攻击模式）、工具耐久系统 | [你的名字] |
| v1.2 | 2025-12-14 | 可放置物品系统、E键交互切换、睡眠功能完善、UI状态管理 | [你的名字] |

---

## 📑 目录

1. [游戏概述](#游戏概述)
2. [核心玩法](#核心玩法)
3. [游戏系统设计](#游戏系统设计)
4. [物品与配方](#物品与配方)
5. [敌人与AI](#敌人与ai)
6. [建筑与设施](#建筑与设施)
7. [游戏流程](#游戏流程)
8. [开发路线图](#开发路线图)
9. [技术架构](#技术架构)
10. [术语表](#术语表)
---

## 游戏概述

### 游戏类型
3D 生存经营游戏（Survival Crafting + Light RPG）

### 核心概念
- 玩家在开放3D世界中生存
- 采集资源、合成工具、建造基地
- 对抗敌人、探索世界、解锁配方
- 类似"3D版星露谷物语 + 生存元素"

### 目标玩家
- 喜欢生存建造类游戏的玩家
- 年龄：12岁以上

### 游戏特色
- 舒适的移动和操作手感
- 丰富的资源采集和合成系统
- 自由的建造和基地经营
- 适度的战斗和生存压力
- 探索和进度解锁

---

## 核心玩法


### 核心循环
探索周围环境，采集基础资源 → 合成工具/武器/食物 → 建造避难所/防御工事 → 遭遇敌对生物（被动威胁）【 选择：躲避 / 逃跑 / 防御 / 击退 / 主动击杀（获取资源）】→ 获得掉落资源/食物 → 强化基地/制作更好的装备 → 探索更远的区域（更危险）


### 玩家目标

**短期目标（前1小时）**
- 采集基础资源（木材、石头）
- 制作第一把工具和武器
- 建造简单避难所（抵御夜晚威胁）
- 生存第一个夜晚

**中期目标（1-10小时）**
- 升级工具和装备（更安全地采集）
- 建造完整基地（围墙、陷阱、照明）
- 种植作物（稳定食物来源）
- 探索周边区域（发现新资源点）
- 建立防御体系（抵御敌人袭击）

**长期目标（10+小时）**
- 建造大型安全基地（多层防御）
- 建立自动化生产（农田、陷阱、熔炉）
- 探索危险区域（洞穴、沼泽、雪山）
- 掌握所有生存技能
- 在这个世界长期生存下去

**核心目标：在陌生的世界中活下去，建立安全的家园**

---

## 游戏系统设计

### 3. 1 角色系统

**角色属性**
- 生命值（HP）：100
- 体力（Stamina）：100
- 饥饿度（Hunger）：100
- 攻击力（Attack）：5
- 防御力（Defense）：0
- 移动速度（Speed）：5
- 采集速度（GatherSpeed）：1. 0

**状态效果系统（Buff/Debuff）**

游戏采用通用Buff系统，所有状态效果（中毒、燃烧、加速等）都通过统一的Buff机制实现。

**Buff类型：**
- **持续伤害（DoT）：** 每秒造成伤害（中毒、燃烧、冻伤、沼泽毒素）
- **持续治疗（HoT）：** 每秒恢复生命（再生、饱食恢复）
- **属性修改：** 临时改变角色属性（加速、虚弱、力量）

**常见Buff效果：**

| Buff名称 | 类型 | 效果 | 持续时间 | 来源 |
|---------|------|------|---------|------|
| 🤢 中毒 | 持续伤害 | -2HP/秒 | 10秒 | 吃生肉、蜘蛛攻击 |
| 🔥 燃烧 | 持续伤害 | -3HP/秒 | 5秒 | 接触火焰 |
| ☠️ 沼泽毒素 | 持续伤害 | -2HP/秒 | 持续 | 站在毒沼泽 |
| ❄️ 寒冷 | 持续伤害 | -1HP/10秒 | 持续 | 雪地夜晚无篝火 |
| 💚 再生 | 持续治疗 | +2HP/秒 | 30秒 | 药水、食物 |
| ⚡ 加速 | 属性修改 | 速度+50% | 20秒 | 药水 |
| 😵 虚弱 | 属性修改 | 攻击-30% | 15秒 | 敌人技能 |
| 🍖 饱食 | 属性修改 | 饥饿消耗-50% | 60秒 | 高级食物 |
| 💪 力量 | 属性修改 | 攻击+30% | 60秒 | 药水 |

**Buff特性：**
- Buff可以叠加（如果设置为stackable）
- 不可叠加的Buff会刷新持续时间
- 某些Buff在特定条件下自动移除（如离开沼泽）
- 玩家可以看到所有激活的Buff图标和剩余时间

**死亡机制**
- HP归零→角色死亡
- 掉落50%背包物品
- 在床/出生点复活

---

### 3.2 移动系统

**基础移动**
- W：前进（5m/s）
- S：后退（3m/s）
- A/D：侧移（4m/s）
- Space：跳跃（CD 0.5秒）
- Shift：冲刺（8m/s，消耗体力5/秒）

**移动细节**
- 加速时间：0.5秒
- 减速时间：0.3秒
- 转向时间：0.2秒
- 跳跃高度：可跳过1格方块
- 空中控制：50%控制力

**镜头控制**
- 鼠标左右：水平360度旋转
- 鼠标上下：垂直-80°至+80°
- 灵敏度：可调节（默认0.5）
- 镜头距离：3米（第三人称）
- 镜头平滑：开启

---

### 3.3 采集系统

**采集机制（HP攻击模式）**

资源物体拥有生命值（HP），玩家通过持续攻击来采集资源：

1. 靠近资源（3米内）
2. 显示提示"🪓 砍伐 [左键]"或"⛏️ 采集 [左键]"
3. 按住鼠标左键持续攻击
4. 每次攻击：
   - 资源HP减少
   - 消耗工具耐久（如有装备）
   - 显示伤害数字和剩余HP
5. HP归零后：
   - 资源消失
   - 获得掉落物品
   - 触发粒子效果+音效（后续添加）

**可采集资源**
| 资源 | HP | 空手伤害 | 推荐工具 | 掉落物 |
|------|-----|---------|---------|--------|
| 树木 | 80-120 | 3 | 斧头 | 木材x3-5 |
| 岩石 | 100-150 | 1 | 镐子 | 石头x2-4 |
| 灌木 | 20-30 | 5 | 无需工具 | 浆果x1-3 |
| 草丛 | 10-15 | 5 | 无需工具 | 纤维x1-2 |
| 铁矿 | 150-200 | 1 | 石镐+ | 铁矿石x1-2 |
| 铜矿 | 120-160 | 1 | 石镐+ | 铜矿石x1-2 |

**工具采集伤害**

不同工具对不同资源有不同的采集效率：

| 工具 | 对木材伤害 | 对石头伤害 | 默认伤害 | 耐久 |
|------|-----------|-----------|---------|------|
| 空手 | 3 | 1 | 2 | - |
| 石斧 | 15 | 5 | 8 | 100 |
| 木镐 | 5 | 12 | 6 | 60 |
| 石镐 | 6 | 20 | 10 | 120 |

**采集时间计算**
采集时间 = 资源HP ÷ 工具伤害 × 攻击间隔

示例：砍树（HP=100）

空手：100 ÷ 3 × 0.4秒 ≈ 13秒
石斧：100 ÷ 15 × 0.4秒 ≈ 2.7秒

**攻击间隔**
- 默认攻击冷却：0.4秒
- 每次攻击消耗工具耐久：1点

**采集反馈**
- 伤害数字显示（💥 -15）
- HP百分比显示（85%）
- 工具耐久显示（🔧 99）
- 资源摧毁时的奖励提示

---

### 3.4 背包系统

**容量**
- 背包：40格
- 快捷栏：5格
- 装备栏：6格（头、身、腿、脚、主手、副手）

**物品堆叠**
- 资源：64
- 食物：32
- 工具/武器：1
- 装备：1
- 建材：99

**背包操作**
- Tab：打开/关闭背包
- 鼠标拖拽：移动物品
- Shift+点击：快速移动
- 拖出背包：丢弃
- 右键点击：分堆

**快捷栏操作**
- 数字键1-5：选择快捷栏槽位
- 鼠标滚轮：切换快捷栏槽位
- **注意：** 当任意UI打开时（背包、存储、烹饪），数字键和滚轮切换被禁用

---

### 3.5 装备系统

**装备槽位**
- 头部：头盔（+防御）
- 身体：胸甲（+防御）
- 腿部：护腿（+防御）
- 脚部：靴子（+防御+速度）
- 主手：工具/武器（+攻击+采集）
- 副手：盾牌/火把（+防御/照明）

**装备效果示例**

**基础属性加成：**
- 木剑：攻击力+5
- 石剑：攻击力+10
- 铁剑：攻击力+20

**套装效果（Buff）：**
- 皮革套装（4件）：防御+8
- 铁制套装（4件）：防御+20
- 皮革套装特效：穿戴3件以上，获得"轻盈"Buff（移动速度+10%）  ← 新增
- 铁制套装特效：穿戴3件以上，获得"坚韧"Buff（受到伤害-10%）  ← 新增

**特殊装备效果：**
- 铁靴子：穿戴时获得"稳固"Buff（免疫击退）
- 夜视头盔：穿戴时获得"夜视"Buff（夜晚能见度提升）

**装备耐久**

工具和武器拥有耐久度，使用时会消耗：

| 物品类型 | 耐久消耗时机 | 消耗量 |
|---------|-------------|-------|
| 工具（斧头、镐子） | 每次采集攻击 | 1点/次 |
| 武器（剑、矛） | 每次攻击敌人 | 1点/次 |
| 护甲 | 每次受到伤害 | 1点/次（后续实现） |

**耐久度归零**
- 装备自动损坏
- 从装备槽移除
- 显示损坏提示"⚠️ 石斧损坏了！"
- 需要重新制作

**耐久度显示**
- 采集时显示当前耐久（🔧 99）
- 背包中显示耐久百分比（后续UI实现）
- 耐久低于20%时警告提示（后续实现）

**修复系统（后续实现）**
- 工作台可修复装备
- 消耗50%原材料
- 恢复100%耐久

---

### 3.6 合成系统

**合成方式**
- 手工合成：背包内直接合成基础物品
- 工作台：高级工具、武器、装备
- 熔炉：矿石→金属锭
- 烹饪台：食物、药水

#### 3.6.2 配方解锁

配方解锁不依赖"击败敌人"，而是自然探索和学习：

| 解锁方式 | 说明 | 示例 |
|---------|------|------|
| **自动解锁** | 获得新材料自动解锁相关配方 | 获得铁锭→解锁铁制工具 |
| **探索解锁** | 探索特定地点发现配方 | 废弃营地的笔记、洞穴壁画 |
| **实验解锁** | 尝试组合材料发现配方 | 木材+石头→发现石斧 |
| **书籍解锁** | 找到书籍/图纸 | 哥布林营地的箱子里 |

**没有任何配方需要"击败Boss"才能解锁。**

---

### 3.7 战斗系统（简化版）

**设计理念：**
- 战斗不是游戏重点，保持简单易上手
- 主要目的是"防御"和"获取资源"，不是"打怪升级"

**战斗操作**
- 鼠标左键：轻攻击（100%伤害）
- 鼠标右键：格挡（盾牌减伤50%）

**伤害计算**
最终伤害 = (攻击力 - 防御力) × 武器倍率 × 暴击倍率
- 暴击率：5% + 装备加成
- 暴击倍率：1.5x

**攻击判定**
- 近战：扇形120度，1.5米
- 远程：射线检测
- 范围：球形检测

**受击反馈**
- 后仰动画
- 伤害数字飘出
- 血液粒子
- 屏幕震动
- 打击音效

---

### 3.8 生存系统

**饥饿机制**
- 饱食（80-100）：生命恢复1HP/10秒
- 正常（40-80）：无效果
- 饥饿（10-40）：体力恢复-50%
- 饥荒（0-10）：生命减少1HP/10秒

**饥饿度消耗**
- 正常：1点/分钟
- 冲刺：2点/分钟
- 战斗：3点/分钟

**食物系统**
- 生肉：+10饥饿，10%中毒
- 熟肉：+30饥饿，+5HP
- 浆果：+5饥饿
- 面包：+40饥饿
- 炖肉：+60饥饿，+20HP，饱食Buff
- 药水：+50HP

**烹饪**
- 篝火：烤肉
- 烹饪台：炖菜、面包
- 熔炉：冶炼金属


**环境伤害**

环境伤害通过Buff系统实现：

| 环境 | Buff效果 | 触发条件 |
|------|---------|---------|
| **溺水** | 窒息Buff（-10HP/秒） | 水下超过10秒 |
| **跌落** | 瞬间伤害（-10HP） | 从5米以上跌落 |
| **火焰** | 燃烧Buff（-5HP/秒） | 接触火源 |
| **毒沼泽** | 沼泽毒素Buff（-2HP/秒） | 站在毒水中 |
| **寒冷** | 冻伤Buff（-1HP/10秒） | 雪地夜晚无篝火 |

**特殊说明：**
- 跌落伤害是瞬间伤害，不是Buff
- 其他环境伤害都通过Buff实现
- 离开危险区域后，对应Buff自动移除

---

### 3.9 建造系统

**设施放置（Minecraft风格）**

设施物品（篝火、工作台、箱子、床等）采用"制作→手持→放置"的直观操作方式：

1. **制作设施物品：** 在合成界面制作设施物品（如篝火、工作台）
2. **装备到快捷栏：** 将设施物品放入快捷栏
3. **选择并手持：** 按数字键或鼠标滚轮选择快捷栏中的设施物品
4. **自动进入放置模式：** 手持可放置物品时，自动显示放置预览（绿色/红色透明模型）
5. **确认放置：** 鼠标左键放置，R键旋转90度
6. **消耗物品：** 放置成功后，快捷栏中的物品数量减1

**可放置物品列表：**
| 物品 | 放置类型 | 说明 |
|------|---------|------|
| 篝火 | campfire | 烹饪、照明 |
| 工作台 | workbench | 高级合成 |
| 箱子 | chest | 存储物品 |
| 床 | bed | 复活点、跳过夜晚 |

**放置控制：**
- **自动检测：** 手持可放置物品时自动进入放置模式
- **R键：** 旋转建筑90度
- **鼠标左键：** 确认放置（消耗物品）
- **切换其他物品：** 退出放置模式

**建筑交互（E键）**

放置的建筑设施可通过E键进行交互：

| 建筑 | 交互方式 | 功能 |
|------|---------|------|
| 工作台 | E键 | 打开高级合成界面 |
| 箱子 | E键 | 打开存储界面 |
| 篝火 | E键 | 打开烹饪界面 |
| 床 | E键（夜晚） | 跳过夜晚到次日清晨 |

**交互UI切换：**
- E键可以打开和关闭交互UI（存储/烹饪界面）
- 当交互UI打开时，再次按E键会关闭当前UI
- 打开任意UI时（背包、存储、烹饪），不能打开其他UI
- UI打开时禁用鼠标滚轮和数字键切换快捷栏

**建筑放置限制：**
- 需要平坦地面（坡度<30度）
- 不能与其他物体碰撞重叠
- 需要足够的放置空间

---

### 3.10 农业系统

**作物系统**
- 小麦：3天生长，收获x3-5，售价5金币
- 胡萝卜：2天生长，收获x2-4，售价8金币
- 番茄：4天生长，收获x4-6，售价10金币
- 土豆：3天生长，收获x3-5，售价6金币

**种植流程**
1. 制作锄头
2. 翻耕土地
3. 播种
4. 浇水（每天1次）
5. 等待生长
6. 收获

**农田机制**
- 干燥（红色）：需要浇水
- 湿润（绿色）：正常生长
- 肥沃（金色）：生长+50%

**施肥**
- 基础肥料：生长+25%
- 高级肥料：生长+50%，产量+50%

**季节影响**
- 春季：正常生长
- 夏季：小麦+50%
- 秋季：胡萝卜+50%
- 冬季：无法生长（需温室）

---

### 3.11 敌对生物系统

#### 3.11.1 设计理念

**敌对生物不是"怪物"，而是"野生动物/敌对势力"：**
- 它们有自己的栖息地和领地
- 它们有自己的生活习性（觅食、休息、繁殖）
- 它们不会"主动刷新"在玩家周围
- 玩家进入它们的领地才会触发攻击
- 夜晚或特定条件下，部分生物会主动袭击玩家基地

---

#### 3.11.2 敌对生物类型

**1. 野生捕食者（森林区域）**

**森林狼（Wolf）**
- **栖息地：** 森林深处
- **习性：** 群居（2-5只），白天休息，夜晚活动
- **攻击条件：** 
  - 玩家进入领地（森林深处）
  - 玩家HP<50%（闻到血腥味）
  - 夜晚时靠近玩家基地（寻找食物）
- **威胁等级：** 中等
- **数据：** HP 40, 攻击 8, 速度 6
- **掉落：** 生肉x1-2, 兽皮x1-2, 狼牙x0-1
- **行为：** 
  - 白天：在森林深处休息，除非玩家主动挑衅
  - 夜晚：游荡寻找食物，可能袭击玩家基地
  - 受伤后：逃跑（HP<30%）

**野猪（Boar）**
- **栖息地：** 森林边缘
- **习性：** 独居，白天觅食
- **攻击条件：**
  - 玩家靠太近（3米内）
  - 玩家攻击它
- **威胁等级：** 低
- **数据：** HP 50, 攻击 6, 速度 4
- **掉落：** 生肉x2-4, 兽皮x1
- **行为：**
  - 正常情况下不主动攻击
  - 受到攻击会反击
  - 不会追击太远

---

**2. 敌对部落（草原/荒地）**

**哥布林（Goblin）**
- **栖息地：** 废弃营地、洞穴入口
- **习性：** 群居（3-6只），建立简陋营地
- **攻击条件：**
  - 玩家进入营地范围（15米）
  - 玩家拿走营地的物品（箱子、篝火）
- **威胁等级：** 中等
- **数据：** HP 35, 攻击 7, 速度 5
- **掉落：** 木棒x1-2, 破布x1-2, 金币x1-3
- **行为：**
  - 白天：在营地附近巡逻
  - 夜晚：集体出动，可能袭击玩家基地（发现后）
  - 警报机制：一只哥布林发现玩家会呼叫同伴
  - 战利品：营地中有箱子（基础资源）

---

**3. 洞穴生物（地下/洞穴）**

**洞穴蜘蛛（Cave Spider）**
- **栖息地：** 洞穴、矿洞
- **习性：** 独居，在洞穴天花板织网
- **攻击条件：**
  - 玩家进入洞穴
  - 玩家触碰蛛网
- **威胁等级：** 中高
- **数据：** HP 30, 攻击 9（带毒），速度 7
- **掉落：** 蜘蛛丝x2-4, 毒腺x0-1
- **行为：**
  - 埋伏在洞穴暗处
  - 攻击后退入黑暗
  - 毒素效果：10秒内持续掉血

**骷髅（Skeleton）**
- **栖息地：** 深层洞穴、遗迹
- **习性：** 独居，守卫特定区域
- **攻击条件：**
  - 玩家进入守卫区域
- **威胁等级：** 高
- **数据：** HP 60, 攻击 12, 速度 4
- **掉落：** 骨头x2-4, 铁矿石x1-2, 古代钱币x0-1
- **行为：**
  - 不会离开守卫区域
  - 不会追击逃跑的玩家
  - 击败后不刷新（或很久才刷新）

---

**4. 夜行生物（夜晚出没）**

**游荡者（Wanderer）**
- **栖息地：** 无固定栖息地
- **习性：** 夜晚游荡，白天消失
- **攻击条件：**
  - 夜晚发现玩家
  - 玩家没有光源（火把、篝火）
- **威胁等级：** 中等
- **数据：** HP 45, 攻击 10, 速度 5
- **掉落：** 暗影结晶x0-1, 破烂衣物x1
- **行为：**
  - 只在夜晚出现
  - 害怕光源（篝火、火把）
  - 黎明时消失

---

#### 3.11.3 领地系统

**固定领地：**
- 森林深处：森林狼群领地
- 废弃营地：哥布林营地（3-5个营地分散在地图）
- 洞穴/矿洞：蜘蛛和骷髅的区域
- 沼泽：毒蛙和沼泽史莱姆

**玩家可选择：**
- 绕开领地（安全但资源少）
- 潜入领地（冒险但资源丰富）
- 清理领地（危险但可以占领为基地）

---

#### 3.11.4 袭击机制

**夜晚基地袭击：**
- 触发条件：
  - 玩家建造了大型基地（10+建筑）
  - 夜晚降临
  - 随机概率（30%）
- 袭击规模：
  - 第1-5天：2-3只森林狼
  - 第6-10天：4-6只哥布林
  - 第11+天：混合（狼+哥布林+游荡者）
- 防御手段：
  - 围墙、栅栏（减缓进攻）
  - 陷阱（尖刺陷阱、捕兽夹）
  - 照明（火把、篝火驱赶夜行生物）
  - 守卫塔（未来扩展：雇佣NPC守卫）

**袭击机制：**
1. 夜晚来临时，屏幕提示"感觉到不安的气息..."
2. 5分钟后，敌人从基地外围出现
3. 敌人尝试攻击建筑和玩家
4. 玩家可以：
   - 躲在室内（敌人会攻击门）
   - 主动出击（击退敌人）
   - 依靠陷阱和围墙防守
5. 黎明时，残余敌人撤退

---

#### 3.11.5 AI行为树

根节点
├─ 栖息状态（默认）
│   ├─ 在领地内活动（觅食、休息）
│   ├─ 检测玩家（视野范围）
│   └─ 玩家进入领地 → 切换到警戒状态
│
├─ 警戒状态
│   ├─ 发出警告（咆哮、叫声）
│   ├─ 玩家继续靠近 → 切换到攻击状态
│   └─ 玩家离开 → 返回栖息状态
│
├─ 攻击状态
│   ├─ 移动向玩家
│   ├─ 攻击玩家
│   ├─ 玩家逃出领地 → 停止追击，返回栖息
│   └─ HP < 30% → 切换到逃跑状态（部分生物）
│
└─ 逃跑状态
    ├─ 远离玩家
    ├─ 寻找掩护
    └─ 玩家停止追击 → 返回栖息状态

**行为特点：**
- 不会无脑追击玩家到天涯海角
- 优先保护领地，而非击杀玩家
- 受伤后有自保意识（逃跑）
- 玩家离开领地后停止追击

---

#### 3.11.6 掉落物资源

**掉落物不是"配方"或"解锁道具"，而是生存资源：**

- **森林狼：** 生肉（食物）、兽皮（制作皮革装备）、狼牙（制作项链、装饰）
- **野猪：** 大量生肉（稳定食物来源）、兽皮
- **哥布林：** 木棒（燃料）、破布（修理装备）、少量金币（未来交易用）
- **蜘蛛：** 蜘蛛丝（制作绳索、网）、毒腺（制作毒药箭矢）
- **骷髅：** 骨头（制作骨粉肥料）、铁矿石（珍贵资源）
- **游荡者：** 暗影结晶（夜视药水材料）

**所有掉落物都有实际用途，不是为了"解锁"而掉落。**

---

#### 3.11.7 敌对生物生成规则

**不是"刷新"，而是"栖息"：**

1. **世界生成时预设敌对生物：**
   - 森林深处：固定2-3个狼群营地
   - 草原：固定4-5个哥布林营地
   - 洞穴：每个洞穴固定数量的蜘蛛和骷髅

2. **生物数量有限：**
   - 击杀后需要很长时间才重新生成（7-10天游戏时间）
   - 或者不重新生成（鼓励玩家"清理领地"）

3. **夜晚游荡者：**
   - 每晚随机生成2-5只
   - 黎明消失
   - 不占用白天生物数量

**玩家可以选择：**
- 避开危险区域（和平生存）
- 清理附近威胁（建立安全区）
- 深入探索（获取更多资源）

### 3.12 探索系统

**危险区域不是"被锁定"的，而是"自然危险"的：**

- **森林深处：** 狼群领地，危险但有大量木材和药草
- **洞穴：** 蜘蛛和骷髅，危险但有铁矿和稀有资源
- **沼泽：** 毒沼泽和毒生物，危险但有炼金材料
- **雪山：** 严寒环境，危险但有高级矿石

**玩家准备好了（更好的装备、更多食物、更强的武器）自然可以探索，没有"解锁"机制。**


### 3.13 世界系统

**昼夜循环**（游戏内20小时 = 现实25分钟）
- 白天（8小时/10分钟）：安全，敌人少
- 黄昏（2小时/2. 5分钟）：过渡
- 夜晚（8小时/10分钟）：危险，敌人多+强
- 黎明（2小时/2.5分钟）：过渡

**天气系统**
- 晴天（60%）：无效果
- 多云（20%）：能见度-10%
- 下雨（15%）：农田自动浇水，移动-10%
- 雷暴（4%）：可能被雷击，农田生长+50%
- 雪（1%）：寒冷伤害，移动-20%

**季节系统**（每季10天）
- 春季：正常
- 夏季：小麦快，白天长
- 秋季：胡萝卜快，掉落增加
- 冬季：作物不生长，敌人更强

**生物群系**
- 草原：新手友好
- 森林：木材丰富，中等难度
- 山脉：矿石丰富，地形复杂
- 沼泽：危险，稀有资源
- 雪原：寒冷伤害，高级资源
- 沙漠：炎热伤害，特殊资源

---

### 3.14 进度系统

**成就系统**
- 新手探险家：探索5区域→称号展示（可选）
- 伐木工：采集100木材→称号展示（可选）
- 矿工：采集50矿石→称号展示（可选）
- 战士：击杀50敌人→称号展示（可选）
- 建筑师：建造20建筑→称号展示（可选）
- 农夫：收获100作物→称号展示（可选）

**没有等级、没有技能点、没有属性加点。**
**玩家的成长完全来自更好的装备和更多的知识（配方）。**

---

### 3.15 UI系统

**HUD（常驻显示）**
- 左上：生命/体力/饥饿条
- 下方：快捷栏
- 右上：小地图、时间/天气
- 中央：交互提示
- 右侧：获得物品提示

**菜单系统**
- 主菜单：开始、读取、设置、退出
- 游戏内（ESC）：继续、背包、成就、地图、设置、退出

**背包UI**
- 标签页：背包、合成、装备、成就

---

### 3.16 存档系统

**存档内容**
- 玩家数据：位置、旋转、属性、等级
- 背包数据：40格+5格快捷栏+6格装备
- 世界数据：时间、天数、季节、天气
- 建筑数据：类型、位置、旋转
- 已解锁配方
- 成就
- 击杀统计

**存档方式**
- 自动存档：每5分钟
- 手动存档：ESC菜单
- 退出存档：自动保存
- 存档位置：LocalStorage/JSON文件

---

### 3.17 Buff系统设计原则

**所有临时状态效果都通过Buff实现：**

**Buff的来源：**
1. ✅ 食物和药水（饱食、再生、力量、速度）
2. ✅ 环境伤害（中毒、燃烧、冻伤、沼泽毒素）
3. ✅ 敌人攻击（中毒、流血、虚弱）
4. ✅ 装备套装（套装特效）
5. ✅ 特殊道具（未来扩展：魔法卷轴、图腾）

**Buff的类型：**
- **持续伤害（DoT）：** 中毒、燃烧、流血、冻伤
- **持续治疗（HoT）：** 再生
- **属性修改：** 加速、力量、虚弱、坚韧
- **特殊效果：** 夜视、免疫击退

**Buff的管理：**
- 不可叠加的Buff会刷新持续时间
- 可叠加的Buff会累加效果（如：多个毒素同时存在）
- 环境Buff（如沼泽毒素）在离开环境后自动移除
- 装备Buff在卸下装备后自动移除

**Buff的UI显示：**
- 屏幕左上角显示所有激活的Buff图标
- 鼠标悬停显示详细信息
- 进度条显示剩余时间
- 正面Buff用暖色（绿、黄、橙）
- 负面Buff用冷色（紫、蓝、灰）



## 物品与配方

本章节列出游戏中的所有基础物品和核心合成配方。

**说明：**
- 配方数据存储在 `src/data/RecipeData.js` 中
- 本文档只列出核心配方（支撑MVP开发）
- 更多配方在开发过程中根据需要添加

---

### 资源物品（采集获得）

| 物品ID | 名称 | 图标 | 堆叠 | 获取方式 | 说明 |
|-------|------|------|------|---------|------|
| wood | 木材 | 🪵 | 64 | 砍树 | 基础建筑材料 |
| stone | 石头 | 🪨 | 64 | 采石 | 基础建筑材料 |
| fiber | 纤维 | 🌾 | 64 | 采草 | 制作绳索 |
| berry | 浆果 | 🫐 | 32 | 采灌木 | 基础食物 |
| raw_meat | 生肉 | 🥩 | 64 | 敌人掉落 | 基础食物 |
| iron_ore | 铁矿石 | ⚙️ | 64 | 采矿 | 冶炼铁锭 |
| copper_ore | 铜矿石 | 🟠 | 64 | 采矿 | 冶炼铜锭 |
| coal | 煤炭 | ⚫ | 64 | 采矿 | 燃料 |
| leather | 皮革 | 🟫 |  64 | 敌人掉落 | 基础材料 |

---

### 材料物品（合成获得）

#### 基础材料

| 物品ID | 名称 | 图标 | 配方 | 合成位置 | 制作时间 |
|-------|------|------|------|---------|---------|
| wooden_stick | 木棒 | 🥢 | 木材x2 | 手工 | 5s |
| rope | 绳子 | 🪢 | 纤维x5 | 手工 | 3s |

#### 金属材料

| 物品ID | 名称 | 图标 | 配方 | 合成位置 | 制作时间 |
|-------|------|------|------|---------|---------|
| iron_ingot | 铁锭 | ⬜ | 铁矿石x1  | 熔炉 | 20s |
| copper_ingot | 铜锭 | 🟧 | 铜矿石x1| 熔炉 | 10s |

---

### 工具物品

#### 斧头（采集木材）

| 物品ID | 名称 | 木材伤害 | 石头伤害 | 耐久 | 配方 |
|-------|------|---------|---------|------|------|
| stone_axe | 石斧 | 15 | 5 | 100 | 木棒x2 + 石头x3 + 纤维x1 |
| iron_axe | 铁斧 | 25 | 8 | 200 | 铁锭x3 + 木棒x2 |

#### 镐子（采集石头/矿石）

| 物品ID | 名称 | 木材伤害 | 石头伤害 | 耐久 | 配方 |
|-------|------|---------|---------|------|------|
| wood_pickaxe | 木镐 | 5 | 12 | 60 | 木棒x2 + 木材x3 + 纤维x1 |
| stone_pickaxe | 石镐 | 6 | 20 | 120 | 木棒x2 + 石头x3 + 纤维x1 |
| iron_pickaxe | 铁镐 | 8 | 30 | 200 | 铁锭x3 + 木棒x2 |

**工具效率说明：**
- 斧头对木材资源伤害高，对石头资源伤害低
- 镐子对石头资源伤害高，对木材资源伤害低
- 使用正确的工具可以大幅提升采集效率
---

### 武器物品

| 物品ID | 名称 | 攻击力 | 耐久 | 配方 | 合成位置 | 制作时间 |
|-------|------|-------|------|------|---------|---------|
| wooden_sword | 木剑 | +5 | 50 | 木材x5 | 手工 | 1s |
| stone_sword | 石剑 | +10 | 100 | 木材x3 + 石头x4 | 工作台 | 1s |
| iron_sword | 铁剑 | +20 | 200 | 铁锭x3 + 木棒x1 | 工作台 | 1s |
| wooden_spear | 木矛 | +8 | 40 | 木材x4 + 木棒x2 | 工作台 | 1s |
| bow | 弓 | +12 | 150 | 木材x5 + 绳子x3 | 工作台 |1s|

---

### 护甲物品

#### 皮革套装

| 物品ID | 名称 | 防御 | 配方 | 合成位置 | 制作时间 |
|-------|------|------|------|---------|---------|
| leather_helmet | 皮革头盔 | +2 | 皮革x5 | 工作台 | 1s |
| leather_chestplate | 皮革胸甲 | +3 | 皮革x8 | 工作台 | 1s |
| leather_leggings | 皮革护腿 | +2 | 皮革x7 | 工作台 | 1s |
| leather_boots | 皮革靴子 | +1 | 皮革x4 | 工作台 | 1s |

**套装效果：暂定


#### 铁制套装

| 物品ID | 名称 | 防御 | 配方 | 合成位置 | 制作时间 |
|-------|------|------|------|---------|---------|
| iron_helmet | 铁头盔 | +5 | 铁锭x5 | 工作台 | 1s |
| iron_chestplate | 铁胸甲 | +8 | 铁锭x8 | 工作台 | 1s |
| iron_leggings | 铁护腿 | +5 | 铁锭x7 | 工作台 | 1s |
| iron_boots | 铁靴子 | +2 | 铁锭x4 | 工作台 | 1s |

**套装效果：暂定

---

### 食物物品

#### 基础食物

| 物品ID | 名称 | 图标 | 饥饿 | 生命 | 特殊效果 | 获取方式 |
|-------|------|------|------|------|---------|---------|
| berry | 浆果 | 🫐 | +5 | 0 | 无 | 采集灌木 |
| raw_meat | 生肉 | 🥩 | +10 | 0 | 10%中毒 | 击杀动物 |

#### 烹饪食物

| 物品ID | 名称 | 图标 | 饥饿 | 生命 | 特殊效果 | 配方 | 合成位置 |
|-------|------|------|------|------|---------|------|---------|
| cooked_meat | 熟肉 | 🍖 | +30 | +5 | 无 | 生肉x1 | 篝火 |
| bread | 面包 | 🍞 | +40 | 0 | 无 | 小麦x3 | 烹饪台 |
| stew | 炖菜 | 🍲 | +60 | +20 | 饱食Buff 60秒 | 熟肉x2 + 胡萝卜x1 | 烹饪台 |

#### 药水（未来扩展）

| 物品ID | 名称 | 图标 | 饥饿 | 生命 | 特殊效果 | 配方 | 合成位置 |
|-------|------|------|------|------|---------|------|---------|
| health_potion | 生命药水 | 💚 | 0 | +50 | 无 | 浆果x5 + 纤维x3 | 烹饪台 |
| regen_potion | 再生药水 | 💚 | 0 | 0 | 再生Buff 30秒 | 药草x3 + 水x1 | 烹饪台 |
| strength_potion | 力量药水 | 💪 | 0 | 0 | 力量Buff 60秒 | 狼牙x2 + 铁锭x1 | 烹饪台 |
| speed_potion | 速度药水 | ⚡ | 0 | 0 | 加速Buff 20秒 | 羽毛x3 + 浆果x2 | 烹饪台 |


## 建筑与设施

### 基础结构

| 建筑 | 材料 | 功能 | 说明 |
|------|------|------|------|
| **木墙** | 木材x5 | 围墙 | 基础防御结构 |
| **木地板** | 木材x3 | 地板 | 建筑地面 |
| **木天花板** | 木材x4 | 天花板 | 建筑顶部 |
| **木门** | 木材x8 | 门 | 可开关，阻挡敌人 |
| **木窗** | 木材x6 | 窗户 | 透光，可射击 |
| **木楼梯** | 木材x7 | 楼梯 | 上下层连接 |

---

### 功能设施

**工作台（Workbench）**
- **材料：** 木材x10 + 石头x5
- **功能：** 解锁高级合成配方
- **解锁配方：** 石剑、铁工具、护甲等

**熔炉（Furnace）**
- **材料：** 石头x20 + 铁矿石x5
- **功能：** 冶炼矿石为金属锭
- **冶炼时间：** 5秒/个
- **燃料：** 煤炭（1煤炭冶炼5个矿石）

**烹饪台（Cooking Station）**
- **材料：** 木材x15 + 石头x10
- **功能：** 制作高级食物
- **可制作：** 面包、炖菜、药水

**篝火（Campfire）**
- **材料：** 木材x10 + 石头x5
- **功能：** 烹饪生肉、提供照明
- **范围：** 5米照明半径

**床（Bed）**
- **材料：** 木材x15 + 纤维x20
- **功能：** 设置复活点、跳过夜晚
- **使用条件：** 夜晚时可以睡觉（E键交互）
- **睡眠效果：** 时间快进到次日清晨（07:00）
- **放置方式：** 制作后放入快捷栏，手持时显示预览，左键放置

**箱子（Chest）**
- **材料：** 木材x12
- **功能：** 存储30格物品
- **说明：** 可以无限建造

---

### 防御建筑

**木栅栏（Wooden Fence）**
- **材料：** 木材x3
- **功能：** 减缓敌人进攻
- **耐久：** 50HP

**尖刺陷阱（Spike Trap）**
- **材料：** 木材x5 + 石头x3
- **功能：** 对踩到的敌人造成10点伤害
- **耐久：** 可使用10次

---



## 游戏流程

### 新手教程（前5分钟）
1. 出生在草原中央
2. 学习WASD移动和鼠标视角
3. 学习空格跳跃
4. 靠近树木，按E采集木材
5. 按Tab打开背包
6. 制作木棒
7. 采集石头
8. 制作石斧和石镐
9. 装备工具到快捷栏
10. 教程完成

### 第一天流程（前30分钟）
- 07:00 出生/教程
- 07:30 采集基础资源（木材x20，石头x15）
- 08:00 制作工具（石斧、石镐、木剑）
- 09:00 探索周围，采集浆果
- 10:00 遇到第一个敌人
- 10:30 战斗击杀
- 11:00 找到建造地点
- 12:00 建造避难所（4墙+地板+门）
- 14:00 制作工作台
- 15:00 探索森林
- 17:00 黄昏，敌人增多
- 18:00 返回基地
- 19:00 夜晚来临
- 20:00 建造床并睡觉
- 07:00 第二天开始

### 进度里程碑

**第1天：**
- ✅ 学会移动和采集
- ✅ 制作基础工具
- ✅ 建造避难所
- ✅ 生存第一夜（躲避夜行生物）

**第3天：**
- ✅ 建造工作台
- ✅ 升级到石制装备
- ✅ 建立围墙防御（抵御袭击）
- ✅ 开始种植作物

**第7天：**
- ✅ 建造熔炉
- ✅ 升级到铁制装备
- ✅ 探索附近洞穴（谨慎）
- ✅ 清理一个哥布林营地（可选）
- ✅ 建立完整的基地防御体系

**第15天：**
- ✅ 建造大型安全基地（多层围墙）
- ✅ 建立自动化农场
- ✅ 探索森林深处（狼群领地）
- ✅ 掌握所有基础配方

**第30天+：**
- ✅ 建造高级防御工事（塔楼、陷阱阵）
- ✅ 探索所有危险区域（沼泽、雪山）
- ✅ 建立多个前哨基地
- ✅ 完全掌握这个世界的生存技巧

**没有"最终Boss"，生存本身就是目标。**

---

## 开发路线图

### 阶段1：基础体验优化（Week 1-3）

**Week 1：移动系统**
- [√] 优化WASD移动（加速度、减速度、转向）
- [√] 优化跳跃手感
- [√] 冲刺功能（Shift加速 + 体力消耗）
- [ ] 添加移动音效
- [ ] 测试调整参数

**Week 2：镜头和交互**
- [ ] 优化鼠标灵敏度
- [ ] 镜头平滑处理
- [ ] 采集动画
- [ ] 采集粒子效果
- [√] 工具耐久系统
- [√] 采集系统重构（HP攻击模式）

**Week 3：角色属性**
- [√] 添加角色属性（HP、体力、饥饿度）
- [√] UI显示（血条、体力条、饥饿条）
- [√] 装备效果生效
- [√] 受伤机制
- [√] 死亡机制

### 阶段2：战斗和生存（Week 4-7）

**Week 4：战斗系统**
- [√] 鼠标左键攻击
- [ ] 攻击动画
- [√] 攻击判定
- [√] 伤害计算
- [√] 受击反馈

**Week 5：敌人AI**
- [√] 生成野猪
- [√] 巡逻AI
- [√] 追击AI
- [√] 攻击AI
- [√] 敌人死亡掉落

**Week 6：生存压力**
- [√] Buff系统（DoT/HoT/属性修正）
- [√] 食物系统（浆果、烤浆果、生肉、熟肉）
- [√] 烹饪系统（通过合成系统制作）
- [√] 中毒机制（生肉10%几率）
- [√] BuffUI显示

**Week 7：昼夜循环**
- [√] 昼夜时间系统
- [√] 光照变化
- [√] 夜晚敌人增多
- [√] 床铺休息

### 阶段3：建造和基地（Week 8-12）

**Week 8-9：建造系统**
- [√] 建造模式（B键开关）
- [√] 放置预览（Ghost预览，绿色/红色）
- [√] 放置建筑（左键放置）
- [√] 旋转建筑（R键90°旋转）
- [√] 建造限制（坡度检测、碰撞检测、材料检测）
- [√] 拆除建筑（右键取消建造）
- [√] 建筑数据（地板、墙、门、栅栏、工作台、篝火、箱子、床、陷阱）
- [√] 建造UI（分类菜单、材料显示、放置状态）

**Week 10：基地功能**
- [√] 工作台（打开制作界面）
- [√] 箱子（30格存储，双向物品转移）
- [√] 床铺（复活点+跳过夜晚，E键交互）
- [√] 篝火（烹饪界面，生肉→熟肉，浆果→烤浆果）
- [√] 建筑交互系统（E键交互，E键切换开关UI）
- [√] 存储UI（StorageUI.vue）
- [√] 烹饪UI（CookingUI.vue）
- [√] **可放置物品系统（Minecraft风格：制作→手持→放置）**
- [√] **UI状态管理（多UI互斥、快捷栏切换禁用）**
- [√] **移除独立建造模式（B键），改为手持物品自动放置**

**Week 11：农业系统**
- [ ] 制作锄头
- [ ] 翻耕土地
- [ ] 播种系统
- [ ] 浇水系统
- [ ] 作物生长
- [ ] 收获作物

**Week 12：完善和测试**
- [ ] Bug修复
- [ ] 平衡调整
- [ ] 性能优化
- [ ] MVP测试

### 阶段4：内容扩展（长期）
- 更多敌人类型
- 地下洞穴
- 交易系统
- 任务系统
- 多人模式（可选）

---

## 技术架构

### 技术栈
- **3D引擎：** Babylon.js 6.x
- **UI框架：** Vue 3 + Composition API
- **状态管理：** Pinia（可选）
- **构建工具：** Vite
- **语言：** JavaScript/TypeScript

### 项目结构

game-main/
├── 📄 GDD.md                          # 游戏设计文档
├── 📄 index.html                      # HTML入口
├── 📄 package.json                    # 依赖配置
├── 📄 package-lock.json               # 依赖锁定文件
├── 📄 README.md                       # 项目说明
├── 📄 vite.config.js                  # Vite配置
│
└── 📁 src/
    ├── 📄 main.js                     # 应用入口
    ├── 📄 App.vue                     # 根组件（UI状态管理、回调注册）
    ├── 📄 style.css                   # 全局样式
    │
    ├── 📁 components/                 # 组件层
    │   ├── 📄 CookingStation.js      # 烹饪站组件
    │   ├── 📄 Interactable.js        # 可交互对象基类
    │   ├── 📄 Inventory.js           # 物品栏组件
    │   └── 📄 Storage.js             # 存储箱组件
    │
    ├── 📁 data/                       # 数据层
    │   ├── 📄 BuildingData.js        # 建筑数据（设施定义、交互类型）
    │   └── 📄 RecipeData.js          # 配方数据（物品、合成配方、可放置属性）
    │
    ├── 📁 engine/                     # 引擎层
    │   └── 📄 GameEngine.js          # 游戏核心引擎（Babylon.js封装）
    │
    ├── 📁 entities/                   # 实体层
    │   ├── 📄 Bed.js                 # 床实体（睡眠交互）
    │   ├── 📄 Enemy.js               # 敌人实体
    │   └── 📄 Player.js              # 玩家实体
    │
    ├── 📁 scenes/                     # 场景层
    │   └── 📄 MainScene.js           # 主游戏场景（交互、建造、战斗逻辑）
    │
    ├── 📁 systems/                    # 系统层（ECS架构）
    │   ├── 📄 BabylonInputSystem.js  # 输入处理系统（基于Babylon.js）
    │   ├── 📄 BuffSystem.js          # Buff状态效果系统
    │   ├── 📄 BuildingSystem.js      # 建造放置系统（预览、验证、放置）
    │   ├── 📄 CameraController.js    # 相机控制系统
    │   ├── 📄 CombatSystem.js        # 战斗系统
    │   ├── 📄 CraftingSystem.js      # 制作/合成系统
    │   ├── 📄 EquipmentSystem.js     # 装备系统
    │   ├── 📄 InputSystem.js         # 通用输入系统
    │   ├── 📄 PhysicsSystem.js       # 物理系统
    │   ├── 📄 PickingSystem.js       # 拾取系统
    │   ├── 📄 ResourceSystem.js      # 资源管理系统
    │   ├── 📄 TerrainSystem.js       # 地形系统
    │   └── 📄 TimeSystem.js          # 时间系统（昼夜循环、skipNight）
    │
    ├── 📁 utils/                      # 工具层
    │   └── 📄 logger.js              # 日志工具
    │
    ├── 📁 views/                      # UI视图层（Vue组件）
    │   ├── 📄 BuffUI.vue             # Buff状态显示UI
    │   ├── 📄 CookingUI.vue          # 烹饪界面UI
    │   ├── 📄 CraftingUI.vue         # 合成制作UI界面
    │   ├── 📄 CrosshairUI.vue        # 准星UI
    │   ├── 📄 DamageNumberUI.vue     # 伤害数字显示UI
    │   ├── 📄 DeathScreenUI.vue      # 死亡UI界面
    │   ├── 📄 HotbarUI.vue           # 快捷栏UI界面
    │   ├── 📄 InventoryUI.vue        # 物品栏UI界面
    │   ├── 📄 LoadingScreenUI.vue    # 加载UI界面
    │   ├── 📄 PlayerStatsUI.vue      # 玩家状态UI界面
    │   ├── 📄 StorageUI.vue          # 存储箱UI界面
    │   ├── 📄 TimeUI.vue             # 时间显示UI
    │   └── 📄 UnifiedUI.vue          # 统一UI容器
    │
    └── 📁 world/                      # 世界生成层
        ├── 📄 EnvironmentSpawner.js  # 环境对象生成
        ├── 📄 NoiseGenerator.js      # 噪声生成器
        └── 📄 TerrainGenerator.js    # 地形生成器

----


### 核心系统架构

**数据层（Data Layer）**
- RecipeData.js：所有游戏数据（Factorio风格）
- 物品、配方、敌人、建筑统一管理

**逻辑层（Logic Layer）**
- GameEngine：Babylon.js封装
- MainScene：场景管理
- Systems：各功能系统
- Components：可复用组件

**表现层（Presentation Layer）**
- Vue3组件：所有UI
- Babylon.js：3D渲染
- 事件驱动：系统间通信

### 关键设计模式
- **单例模式：** GameEngine
- **组件模式：** Inventory、EquipmentSystem、BabylonInputSystem
- **观察者模式：** UI事件监听、Babylon.js事件系统
- **数据驱动：** RecipeData配方系统

---


### 开发建议
- 每周完成一个小阶段
- 每天提交代码
- 定期测试和调整
- 记录开发日志
- 寻求玩家反馈

---


## 术语表

| 术语 | 说明 |
|------|------|
| **栖息地** | 敌对生物的固定居住区域，进入后才会触发攻击 |
| **领地** | 敌对生物的活动范围，离开领地后停止追击玩家 |
| **袭击** | 夜晚敌对生物主动攻击玩家基地的事件 |
| **配方** | 合成物品所需的材料组合 |
| **buff/debuff** | 正面/负面状态效果 |
| **MVP** | 最小可玩原型（Minimum Viable Prototype）|
| **HUD** | 抬头显示（Heads-Up Display），游戏中常驻的UI元素 |
| **CD** | 冷却时间（Cooldown），技能或动作的间隔时间 |

---

**文档结束**

制作者：[你的名字]  
最后更新：2025-12-14  
版本：v1.2

**祝开发顺利！** 🎮✨